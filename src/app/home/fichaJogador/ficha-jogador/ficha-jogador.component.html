<div class="character-sheet-container">
    <!-- Character Header -->
    <div class="character-header card shadow-lg mb-4">
        <div class="card-body">
            <div class="row align-items-center">
                <div class="col-md-3 text-center mb-3 mb-md-0">
                    <div class="avatar-container">
                        <img [src]="jogador.avatar" alt="Avatar do jogador" class="avatar-img">
                        <div class="avatar-overlay">
                            <i class="fas fa-user-circle"></i>
                        </div>
                    </div>
                </div>
                <div class="col-md-9">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <h2 class="character-name mb-2">
                                <i class="fas fa-user-shield me-2"></i>{{jogador.nome || 'Sem Nome'}}
                            </h2>
                            <div class="character-details">
                                <span class="detail-badge">
                                    <i class="fas fa-hat-wizard me-1"></i>{{jogador.classe || 'Classe'}}
                                </span>
                                <span class="detail-badge">
                                    <i class="fas fa-users me-1"></i>{{jogador.raca || 'Raça'}}
                                </span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="row g-2">
                                <div class="col-6">
                                    <div class="stat-mini">
                                        <i class="fas fa-level-up-alt"></i>
                                        <span class="stat-label">Nível</span>
                                        <span class="stat-value">{{jogador.nivel || 0}}</span>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="stat-mini">
                                        <i class="fas fa-certificate"></i>
                                        <span class="stat-label">Proficiência</span>
                                        <span class="stat-value">+{{jogador.proficiencia || 0}}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="action-buttons-header mt-3">
                <button class="btn btn-warning btn-sm" type="button" data-bs-toggle="modal" data-bs-target="#editarFichaModal">
                    <i class="fas fa-edit me-1"></i>Editar Ficha
                </button>
                <button class="btn btn-info btn-sm" (click)="baixarJogador()">
                    <i class="fas fa-download me-1"></i>Baixar
                </button>
                <label class="btn btn-success btn-sm mb-0">
                    <i class="fas fa-upload me-1"></i>Carregar
                    <input type="file" class="d-none" (change)="carregarJogador($event)" accept=".json">
                </label>
                <button class="btn btn-danger btn-sm" (click)="confirmarLimparCache()">
                    <i class="fas fa-trash-alt me-1"></i>Limpar
                </button>
            </div>
        </div>
    </div>

    <!-- Combat Stats Section -->
    <div class="row mb-4">
        <div class="col-lg-6 mb-3">
            <div class="card shadow-sm combat-card">
                <div class="card-header bg-danger text-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="fas fa-heart-broken me-2"></i>Combate</h5>
                        <button type="button" class="btn btn-light btn-sm" (click)="toggleEditarCombate()">
                            <i class="fas" [ngClass]="editandoCombate ? 'fa-check' : 'fa-edit'" [title]="editandoCombate ? 'Salvar' : 'Editar'"></i>
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-4">
                            <div class="combat-stat">
                                <i class="fas fa-heart text-danger"></i>
                                <span class="stat-label">PV Máx</span>
                                <input *ngIf="editandoCombate" type="number" class="stat-input" [(ngModel)]="jogador.pv" (change)="saveToCache()">
                                <span *ngIf="!editandoCombate" class="stat-value">{{jogador.pv || 0}}</span>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="combat-stat active">
                                <i class="fas fa-heartbeat text-success"></i>
                                <span class="stat-label">PV Atual</span>
                                <input type="number" class="stat-input" [(ngModel)]="jogador.pva" (change)="saveToCache()">
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="combat-stat">
                                <i class="fas fa-shield-alt text-primary"></i>
                                <span class="stat-label">CA</span>
                                <span class="stat-value">{{caCalculada}}</span>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="combat-stat">
                                <i class="fas fa-running text-info"></i>
                                <span class="stat-label">Deslocamento</span>
                                <input *ngIf="editandoCombate" type="number" class="stat-input" [(ngModel)]="jogador.deslocamento" (change)="saveToCache()">
                                <span *ngIf="!editandoCombate" class="stat-value">{{jogador.deslocamento || 0}}</span>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="combat-stat">
                                <i class="fas fa-bolt text-warning"></i>
                                <span class="stat-label">Iniciativa</span>
                                <input *ngIf="editandoCombate" type="number" class="stat-input" [(ngModel)]="jogador.iniciativa" (change)="saveToCache()">
                                <span *ngIf="!editandoCombate" class="stat-value">+{{jogador.iniciativa || 0}}</span>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="combat-stat">
                                <i class="fas fa-star text-warning"></i>
                                <span class="stat-label">Inspiração</span>
                                <input *ngIf="editandoCombate" type="number" class="stat-input" [(ngModel)]="jogador.inspiracao" (change)="saveToCache()">
                                <span *ngIf="!editandoCombate" class="stat-value">{{jogador.inspiracao || 0}}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Attributes Section -->
        <div class="col-lg-6 mb-3">
            <div class="card shadow-sm attributes-card">
                <div class="card-header bg-primary text-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="fas fa-dumbbell me-2"></i>Atributos</h5>
                        <button type="button" class="btn btn-light btn-sm" (click)="toggleEditarAtributos()">
                            <i class="fas" [ngClass]="editandoAtributos ? 'fa-check' : 'fa-edit'" [title]="editandoAtributos ? 'Salvar' : 'Editar'"></i>
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row g-2">
                        <div class="col-4 col-md-4">
                            <div class="attribute-box">
                                <i class="fas fa-fist-raised"></i>
                                <span class="attr-name">FOR</span>
                                <input *ngIf="editandoAtributos" type="number" inputmode="decimal" class="attr-input" [(ngModel)]="jogador.atributos.forca" (change)="saveToCache()">
                                <span *ngIf="!editandoAtributos" class="attr-value">{{jogador.atributos.forca || 10}}</span>
                                <span class="attr-modifier">{{ (calcularModificador(jogador.atributos.forca) ?? 0) >= 0 ? '+' : '' }}{{ calcularModificador(jogador.atributos.forca) ?? 0 }}</span>
                            </div>
                        </div>
                        <div class="col-4 col-md-4">
                            <div class="attribute-box">
                                <i class="fas fa-running"></i>
                                <span class="attr-name">DES</span>
                                <input *ngIf="editandoAtributos" type="number" inputmode="decimal" class="attr-input" [(ngModel)]="jogador.atributos.destreza" (change)="saveToCache()">
                                <span *ngIf="!editandoAtributos" class="attr-value">{{jogador.atributos.destreza || 10}}</span>
                                <span class="attr-modifier">{{ (calcularModificador(jogador.atributos.destreza) ?? 0) >= 0 ? '+' : '' }}{{ calcularModificador(jogador.atributos.destreza) ?? 0 }}</span>
                            </div>
                        </div>
                        <div class="col-4 col-md-4">
                            <div class="attribute-box">
                                <i class="fas fa-heart"></i>
                                <span class="attr-name">CON</span>
                                <input *ngIf="editandoAtributos" type="number" inputmode="decimal" class="attr-input" [(ngModel)]="jogador.atributos.constituicao" (change)="saveToCache()">
                                <span *ngIf="!editandoAtributos" class="attr-value">{{jogador.atributos.constituicao || 10}}</span>
                                <span class="attr-modifier">{{ (calcularModificador(jogador.atributos.constituicao) ?? 0) >= 0 ? '+' : '' }}{{ calcularModificador(jogador.atributos.constituicao) ?? 0 }}</span>
                            </div>
                        </div>
                        <div class="col-4 col-md-4">
                            <div class="attribute-box">
                                <i class="fas fa-brain"></i>
                                <span class="attr-name">INT</span>
                                <input *ngIf="editandoAtributos" type="number" inputmode="decimal" class="attr-input" [(ngModel)]="jogador.atributos.inteligencia" (change)="saveToCache()">
                                <span *ngIf="!editandoAtributos" class="attr-value">{{jogador.atributos.inteligencia || 10}}</span>
                                <span class="attr-modifier">{{ (calcularModificador(jogador.atributos.inteligencia) ?? 0) >= 0 ? '+' : '' }}{{ calcularModificador(jogador.atributos.inteligencia) ?? 0 }}</span>
                            </div>
                        </div>
                        <div class="col-4 col-md-4">
                            <div class="attribute-box">
                                <i class="fas fa-eye"></i>
                                <span class="attr-name">SAB</span>
                                <input *ngIf="editandoAtributos" type="number" inputmode="decimal" class="attr-input" [(ngModel)]="jogador.atributos.sabedoria" (change)="saveToCache()">
                                <span *ngIf="!editandoAtributos" class="attr-value">{{jogador.atributos.sabedoria || 10}}</span>
                                <span class="attr-modifier">{{ (calcularModificador(jogador.atributos.sabedoria) ?? 0) >= 0 ? '+' : '' }}{{ calcularModificador(jogador.atributos.sabedoria) ?? 0 }}</span>
                            </div>
                        </div>
                        <div class="col-4 col-md-4">
                            <div class="attribute-box">
                                <i class="fas fa-comments"></i>
                                <span class="attr-name">CAR</span>
                                <input *ngIf="editandoAtributos" type="number" inputmode="decimal" class="attr-input" [(ngModel)]="jogador.atributos.carisma" (change)="saveToCache()">
                                <span *ngIf="!editandoAtributos" class="attr-value">{{jogador.atributos.carisma || 10}}</span>
                                <span class="attr-modifier">{{ (calcularModificador(jogador.atributos.carisma) ?? 0) >= 0 ? '+' : '' }}{{ calcularModificador(jogador.atributos.carisma) ?? 0 }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Collapsible Sections -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-body">
                    <div class="section-buttons">
                        <button class="btn btn-outline-primary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseMagias">
                            <i class="fas fa-magic me-2"></i>Magias
                        </button>
                        <button class="btn btn-outline-success" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTalentos">
                            <i class="fas fa-star me-2"></i>Talentos
                        </button>
                        <button class="btn btn-outline-dark" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTracos">
                            <i class="fas fa-scroll me-2"></i>Traços
                        </button>
                        <button class="btn btn-outline-warning" type="button" data-bs-toggle="collapse" data-bs-target="#collapseMochila">
                            <i class="fas fa-backpack me-2"></i>Mochila
                        </button>
                        <button class="btn btn-outline-info" type="button" data-bs-toggle="collapse" data-bs-target="#collapseEquipamentos">
                            <i class="fas fa-shield-alt me-2"></i>Equipamentos
                        </button>
                        <button class="btn btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#collapsePericias">
                            <i class="fas fa-tasks me-2"></i>Perícias
                        </button>
                        <button class="btn btn-outline-danger" type="button" data-bs-toggle="collapse" data-bs-target="#collapseCondicoes">
                            <i class="fas fa-heart-broken me-2"></i>Condições
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Magias -->
    <div class="collapse" id="collapseMagias">
        <div class="card shadow-sm mb-3">
            <div class="card-header bg-primary text-white">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="fas fa-magic me-2"></i>Magias</h5>
                    <div>
                        <button type="button" class="btn btn-light btn-sm me-2" (click)="abrirBuscarMagia()">
                            <i class="fas fa-search me-1"></i>Buscar API
                        </button>
                        <button type="button" class="btn btn-light btn-sm" (click)="adicionarMagia()">
                            <i class="fas fa-plus me-1"></i>Adicionar Manual
                        </button>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="spell-list" *ngIf="jogador.magias && jogador.magias.length > 0">
                    <div class="spell-item" *ngFor="let magia of jogador.magias; let i = index">
                        <div *ngIf="!editandoMagia[i]">
                            <div class="spell-header">
                                <div>
                                    <i class="fas fa-wand-magic text-primary"></i>
                                    <strong>{{magia.nome}}</strong>
                                    <span *ngIf="magia.level !== undefined" class="badge bg-primary ms-2">
                                        {{ magia.level === 0 ? 'Truque' : 'Nv ' + magia.level }}
                                    </span>
                                </div>
                                <div>
                                    <button type="button" class="btn btn-sm btn-outline-info me-1"
                                            (click)="toggleSpellDetailsInList(i, magia.nome)"
                                            [disabled]="loadingSpellDetails[i]">
                                        <i class="fas" [ngClass]="expandedSpellDetails[i] ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
                                        <span *ngIf="!loadingSpellDetails[i]">Detalhes</span>
                                        <span *ngIf="loadingSpellDetails[i]">
                                            <i class="fas fa-spinner fa-spin"></i>
                                        </span>
                                    </button>
                                    <button type="button" class="btn btn-sm btn-outline-primary me-1" (click)="toggleEditarMagia(i)">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button type="button" class="btn btn-sm btn-danger" (click)="removerMagia(i)">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </div>
                            </div>
                            <p class="spell-description" *ngIf="!expandedSpellDetails[i]">{{magia.descricao}}</p>

                            <!-- Detalhes expandidos da magia -->
                            <div *ngIf="expandedSpellDetails[i]" class="spell-details-expanded mt-3">
                                <div class="row g-3">
                                    <div class="col-md-6" *ngIf="magia.level !== undefined || (expandedSpellDetails[i] && expandedSpellDetails[i].level !== undefined)">
                                        <div class="detail-box">
                                            <strong><i class="fas fa-layer-group me-2 text-primary"></i>Nível:</strong>
                                            <span>{{ (magia.level !== undefined ? magia.level : expandedSpellDetails[i]?.level) === 0 ? 'Truque' : 'Nível ' + (magia.level !== undefined ? magia.level : expandedSpellDetails[i]?.level) }}</span>
                                        </div>
                                    </div>
                                    <div class="col-md-6" *ngIf="magia.school || (expandedSpellDetails[i] && expandedSpellDetails[i].school)">
                                        <div class="detail-box">
                                            <strong><i class="fas fa-book me-2 text-primary"></i>Escola:</strong>
                                            <span>{{ magia.school || expandedSpellDetails[i]?.school?.name || expandedSpellDetails[i]?.school }}</span>
                                        </div>
                                    </div>
                                    <div class="col-md-6" *ngIf="magia.casting_time || (expandedSpellDetails[i] && expandedSpellDetails[i].casting_time)">
                                        <div class="detail-box">
                                            <strong><i class="fas fa-clock me-2 text-primary"></i>Tempo de Conjuração:</strong>
                                            <span>{{ magia.casting_time || expandedSpellDetails[i]?.casting_time }}</span>
                                        </div>
                                    </div>
                                    <div class="col-md-6" *ngIf="magia.range || (expandedSpellDetails[i] && expandedSpellDetails[i].range)">
                                        <div class="detail-box">
                                            <strong><i class="fas fa-crosshairs me-2 text-primary"></i>Alcance:</strong>
                                            <span>{{ magia.range || expandedSpellDetails[i]?.range }}</span>
                                        </div>
                                    </div>
                                    <div class="col-md-6" *ngIf="(magia.components && magia.components.length > 0) || (expandedSpellDetails[i] && expandedSpellDetails[i].components && expandedSpellDetails[i].components.length > 0)">
                                        <div class="detail-box">
                                            <strong><i class="fas fa-hand-sparkles me-2 text-primary"></i>Componentes:</strong>
                                            <span>{{ getSpellComponents(magia, expandedSpellDetails[i]) }}</span>
                                            <small class="d-block text-muted" *ngIf="magia.material || expandedSpellDetails[i]?.material">{{ magia.material || expandedSpellDetails[i]?.material }}</small>
                                        </div>
                                    </div>
                                    <div class="col-md-6" *ngIf="magia.duration || (expandedSpellDetails[i] && expandedSpellDetails[i].duration)">
                                        <div class="detail-box">
                                            <strong><i class="fas fa-hourglass-half me-2 text-primary"></i>Duração:</strong>
                                            <span>{{ magia.duration || expandedSpellDetails[i]?.duration }}</span>
                                        </div>
                                    </div>
                                    <div class="col-12" *ngIf="(magia.classes && magia.classes.length > 0) || (expandedSpellDetails[i] && expandedSpellDetails[i].classes && expandedSpellDetails[i].classes.length > 0)">
                                        <div class="detail-box">
                                            <strong><i class="fas fa-user-graduate me-2 text-primary"></i>Classes:</strong>
                                            <span>{{ getSpellClassesFormatted(magia, expandedSpellDetails[i]) }}</span>
                                        </div>
                                    </div>
                                    <div class="col-12" *ngIf="expandedSpellDetails[i] && expandedSpellDetails[i].desc && expandedSpellDetails[i].desc.length > 0">
                                        <div class="detail-box">
                                            <strong><i class="fas fa-scroll me-2 text-primary"></i>Descrição:</strong>
                                            <p *ngFor="let paragraph of expandedSpellDetails[i].desc" class="mb-2">{{ paragraph }}</p>
                                        </div>
                                    </div>
                                    <div class="col-12" *ngIf="expandedSpellDetails[i] && expandedSpellDetails[i].higher_level && expandedSpellDetails[i].higher_level.length > 0">
                                        <div class="detail-box">
                                            <strong><i class="fas fa-arrow-up me-2 text-primary"></i>Em Níveis Superiores:</strong>
                                            <p *ngFor="let paragraph of expandedSpellDetails[i].higher_level" class="mb-2">{{ paragraph }}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div *ngIf="editandoMagia[i]" class="edit-form">
                            <div class="row g-2">
                                <div class="col-md-4">
                                    <input type="text" class="form-control form-control-sm" placeholder="Nome" [(ngModel)]="magia.nome" (change)="saveToCache()">
                                </div>
                                <div class="col-md-4">
                                    <input type="text" class="form-control form-control-sm" placeholder="Descrição" [(ngModel)]="magia.descricao" (change)="saveToCache()">
                                </div>
                                <div class="col-md-2">
                                    <select class="form-select form-select-sm" [(ngModel)]="magia.level" (change)="saveToCache()">
                                        <option [ngValue]="undefined">Nível</option>
                                        <option [ngValue]="0">Truque</option>
                                        <option [ngValue]="1">1</option>
                                        <option [ngValue]="2">2</option>
                                        <option [ngValue]="3">3</option>
                                        <option [ngValue]="4">4</option>
                                        <option [ngValue]="5">5</option>
                                        <option [ngValue]="6">6</option>
                                        <option [ngValue]="7">7</option>
                                        <option [ngValue]="8">8</option>
                                        <option [ngValue]="9">9</option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <button type="button" class="btn btn-success btn-sm w-100" (click)="toggleEditarMagia(i)">
                                        <i class="fas fa-check"></i>
                                    </button>
                                </div>
                                <div class="col-md-3">
                                    <input type="text" class="form-control form-control-sm" placeholder="Escola (opcional)" [(ngModel)]="magia.school" (change)="saveToCache()">
                                </div>
                                <div class="col-md-3">
                                    <input type="text" class="form-control form-control-sm" placeholder="Tempo de Conjuração (opcional)" [(ngModel)]="magia.casting_time" (change)="saveToCache()">
                                </div>
                                <div class="col-md-3">
                                    <input type="text" class="form-control form-control-sm" placeholder="Alcance (opcional)" [(ngModel)]="magia.range" (change)="saveToCache()">
                                </div>
                                <div class="col-md-3">
                                    <input type="text" class="form-control form-control-sm" placeholder="Duração (opcional)" [(ngModel)]="magia.duration" (change)="saveToCache()">
                                </div>
                                <div class="col-md-6">
                                    <input type="text" class="form-control form-control-sm" placeholder="Componentes (V, S, M) (opcional)" [(ngModel)]="magia.components" (change)="saveToCache()">
                                </div>
                                <div class="col-md-6">
                                    <input type="text" class="form-control form-control-sm" placeholder="Material (opcional)" [(ngModel)]="magia.material" (change)="saveToCache()">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div *ngIf="!jogador.magias || jogador.magias.length === 0" class="text-muted text-center py-3">
                    <i class="fas fa-magic fa-2x mb-2"></i>
                    <p>Nenhuma magia adicionada ainda</p>
                </div>
                <div *ngIf="adicionandoMagia" class="add-form mt-3">
                    <div class="row g-2">
                        <div class="col-md-4">
                            <input type="text" class="form-control form-control-sm" placeholder="Nome da Magia *" [(ngModel)]="novaMagia.nome">
                        </div>
                        <div class="col-md-4">
                            <input type="text" class="form-control form-control-sm" placeholder="Descrição *" [(ngModel)]="novaMagia.descricao">
                        </div>
                        <div class="col-md-2">
                            <select class="form-select form-select-sm" [(ngModel)]="novaMagia.level">
                                <option [ngValue]="undefined">Nível</option>
                                <option [ngValue]="0">Truque</option>
                                <option [ngValue]="1">1</option>
                                <option [ngValue]="2">2</option>
                                <option [ngValue]="3">3</option>
                                <option [ngValue]="4">4</option>
                                <option [ngValue]="5">5</option>
                                <option [ngValue]="6">6</option>
                                <option [ngValue]="7">7</option>
                                <option [ngValue]="8">8</option>
                                <option [ngValue]="9">9</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <button type="button" class="btn btn-success btn-sm w-100" (click)="confirmarAdicionarMagia()">
                                <i class="fas fa-check"></i>
                            </button>
                            <button type="button" class="btn btn-danger btn-sm w-100 mt-1" (click)="cancelarAdicionarMagia()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="col-md-3">
                            <input type="text" class="form-control form-control-sm" placeholder="Escola (opcional)" [(ngModel)]="novaMagia.school">
                        </div>
                        <div class="col-md-3">
                            <input type="text" class="form-control form-control-sm" placeholder="Tempo de Conjuração (opcional)" [(ngModel)]="novaMagia.casting_time">
                        </div>
                        <div class="col-md-3">
                            <input type="text" class="form-control form-control-sm" placeholder="Alcance (opcional)" [(ngModel)]="novaMagia.range">
                        </div>
                        <div class="col-md-3">
                            <input type="text" class="form-control form-control-sm" placeholder="Duração (opcional)" [(ngModel)]="novaMagia.duration">
                        </div>
                        <div class="col-md-6">
                            <input type="text" class="form-control form-control-sm" placeholder="Componentes (V, S, M) (opcional)" [(ngModel)]="novaMagia.components">
                        </div>
                        <div class="col-md-6">
                            <input type="text" class="form-control form-control-sm" placeholder="Material (opcional)" [(ngModel)]="novaMagia.material">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Talentos -->
    <div class="collapse" id="collapseTalentos">
        <div class="card shadow-sm mb-3">
            <div class="card-header bg-success text-white">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="fas fa-star me-2"></i>Talentos</h5>
                    <div>
                        <button type="button" class="btn btn-light btn-sm me-2" (click)="abrirBuscarTalento()">
                            <i class="fas fa-search me-1"></i>Buscar API
                        </button>
                        <button type="button" class="btn btn-light btn-sm" (click)="adicionarTalento()">
                            <i class="fas fa-plus me-1"></i>Adicionar Manual
                        </button>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="talent-list" *ngIf="jogador.talentos && jogador.talentos.length > 0">
                    <div class="talent-item" *ngFor="let talento of jogador.talentos; let i = index">
                        <div *ngIf="!editandoTalento[i]">
                            <div class="talent-header">
                                <div>
                                    <i class="fas fa-certificate text-success"></i>
                                    <strong>{{talento.nome}}</strong>
                                </div>
                                <div>
                                    <button type="button" class="btn btn-outline-success btn-sm me-1" (click)="toggleEditarTalento(i)">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button type="button" class="btn btn-danger btn-sm" (click)="removerTalento(talento)">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </div>
                            </div>
                            <p class="talent-description">{{talento.descricao}}</p>
                        </div>
                        <div *ngIf="editandoTalento[i]" class="edit-form">
                            <div class="row g-2">
                                <div class="col-md-4">
                                    <input type="text" class="form-control" [(ngModel)]="talento.nome" (change)="saveToCache()">
                                </div>
                                <div class="col-md-6">
                                    <input type="text" class="form-control" [(ngModel)]="talento.descricao" (change)="saveToCache()">
                                </div>
                                <div class="col-md-2">
                                    <button type="button" class="btn btn-success btn-sm w-100" (click)="toggleEditarTalento(i)">
                                        <i class="fas fa-check"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div *ngIf="!jogador.talentos || jogador.talentos.length === 0" class="text-muted text-center py-3">
                    <i class="fas fa-star fa-2x mb-2"></i>
                    <p>Nenhum talento adicionado ainda</p>
                </div>
                <div *ngIf="adicionandoTalento" class="add-form mt-3">
                    <div class="row g-2">
                        <div class="col-md-4">
                            <input type="text" class="form-control" placeholder="Nome do Talento" [(ngModel)]="novoTalento.nome">
                        </div>
                        <div class="col-md-6">
                            <input type="text" class="form-control" placeholder="Descrição do Talento" [(ngModel)]="novoTalento.descricao">
                        </div>
                        <div class="col-md-2">
                            <button type="button" class="btn btn-success btn-sm w-100" (click)="confirmarAdicionarTalento()">
                                <i class="fas fa-check"></i>
                            </button>
                            <button type="button" class="btn btn-danger btn-sm w-100 mt-1" (click)="cancelarAdicionarTalento()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Traços -->
    <div class="collapse" id="collapseTracos">
        <div class="card shadow-sm mb-3">
            <div class="card-header bg-dark text-white">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="fas fa-scroll me-2"></i>Traços de Classe e Raça</h5>
                </div>
            </div>
            <div class="card-body">
                <div class="trait-list" *ngIf="jogador.tracos && jogador.tracos.length > 0">
                    <!-- Traços de Classe -->
                    <div *ngIf="hasTracosClasse()" class="mb-4">
                        <h6 class="text-primary mb-3">
                            <i class="fas fa-hat-wizard me-2"></i>Traços de Classe
                        </h6>
                        <div class="trait-item" *ngFor="let traco of getTracosClasse()">
                            <div class="trait-header">
                                <div>
                                    <i class="fas fa-dice-d20 text-primary"></i>
                                    <strong>{{traco.nome}}</strong>
                                </div>
                                <div>
                                    <button type="button" class="btn btn-danger btn-sm" (click)="removerTraco(traco)">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </div>
                            </div>
                            <p class="trait-description">{{traco.descricao}}</p>
                        </div>
                    </div>

                    <!-- Traços de Raça -->
                    <div *ngIf="hasTracosRaca()">
                        <h6 class="text-success mb-3">
                            <i class="fas fa-users me-2"></i>Traços Raciais
                        </h6>
                        <div class="trait-item" *ngFor="let traco of getTracosRaca()">
                            <div class="trait-header">
                                <div>
                                    <i class="fas fa-dna text-success"></i>
                                    <strong>{{traco.nome}}</strong>
                                </div>
                                <div>
                                    <button type="button" class="btn btn-danger btn-sm" (click)="removerTraco(traco)">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </div>
                            </div>
                            <p class="trait-description">{{traco.descricao}}</p>
                        </div>
                    </div>
                </div>
                <div *ngIf="!jogador.tracos || jogador.tracos.length === 0" class="text-muted text-center py-3">
                    <i class="fas fa-scroll fa-2x mb-2"></i>
                    <p>Nenhum traço adicionado ainda</p>
                    <p class="small">Selecione uma classe e raça para ver os traços automaticamente</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Mochila -->
    <div class="collapse" id="collapseMochila">
        <div class="card shadow-sm mb-3">
            <div class="card-header bg-warning text-dark">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="fas fa-backpack me-2"></i>Mochila</h5>
                    <button type="button" class="btn btn-dark btn-sm" (click)="adicionarItem()">
                        <i class="fas fa-plus me-1"></i>Adicionar
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div class="item-list" *ngIf="jogador.mochila && jogador.mochila.length > 0">
                    <div class="item-card" *ngFor="let item of jogador.mochila; let i = index">
                        <div *ngIf="!editandoItem[i]">
                            <div class="item-header">
                                <div>
                                    <i class="fas fa-box text-warning"></i>
                                    <strong>{{item.nome}}</strong>
                                </div>
                                <div>
                                    <button type="button" class="btn btn-outline-warning btn-sm me-1" (click)="toggleEditarItem(i)">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button type="button" class="btn btn-danger btn-sm" (click)="removerItem(item)">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </div>
                            </div>
                            <p class="item-description">{{item.descricao}}</p>
                        </div>
                        <div *ngIf="editandoItem[i]" class="edit-form">
                            <div class="row g-2">
                                <div class="col-md-4">
                                    <input type="text" class="form-control" [(ngModel)]="item.nome" (change)="saveToCache()">
                                </div>
                                <div class="col-md-6">
                                    <input type="text" class="form-control" [(ngModel)]="item.descricao" (change)="saveToCache()">
                                </div>
                                <div class="col-md-2">
                                    <button type="button" class="btn btn-success btn-sm w-100" (click)="toggleEditarItem(i)">
                                        <i class="fas fa-check"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div *ngIf="!jogador.mochila || jogador.mochila.length === 0" class="text-muted text-center py-3">
                    <i class="fas fa-backpack fa-2x mb-2"></i>
                    <p>Nenhum item na mochila</p>
                </div>
                <div *ngIf="adicionandoItem" class="add-form mt-3">
                    <div class="row g-2">
                        <div class="col-md-4">
                            <input type="text" class="form-control" placeholder="Nome do Item" [(ngModel)]="novoItem.nome">
                        </div>
                        <div class="col-md-6">
                            <input type="text" class="form-control" placeholder="Descrição do Item" [(ngModel)]="novoItem.descricao">
                        </div>
                        <div class="col-md-2">
                            <button type="button" class="btn btn-success btn-sm w-100" (click)="confirmarAdicionarItem()">
                                <i class="fas fa-check"></i>
                            </button>
                            <button type="button" class="btn btn-danger btn-sm w-100 mt-1" (click)="cancelarAdicionarItem()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Equipamentos -->
    <div class="collapse" id="collapseEquipamentos">
        <div class="card shadow-sm mb-3">
            <div class="card-header bg-info text-white">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="fas fa-shield-alt me-2"></i>Equipamentos</h5>
                    <div>
                        <button type="button" class="btn btn-light btn-sm me-2" (click)="adicionarEquipamento()">
                            <i class="fas fa-plus me-1"></i>Adicionar
                        </button>
                        <span class="gold-display">
                            <i class="fas fa-coins me-1"></i>
                            <input type="number" class="gold-input" [(ngModel)]="jogador.ouro" (change)="saveToCache()"> PO
                        </span>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="equipment-grid" *ngIf="hasEquipment()">
                    <div *ngFor="let categoria of ['cabeca', 'armadura', 'pes','escudo', 'anel','amuleto']" class="equipment-category">
                        <h6 class="category-title" *ngIf="jogador.equipamentos[categoria]?.length > 0">
                            <i class="fas" [ngClass]="getCategoryIcon(categoria)"></i>
                            {{ getCategoryName(categoria) }}
                        </h6>
                        <div class="equipment-item" *ngFor="let equipamento of jogador.equipamentos[categoria]; let i = index">
                            <div *ngIf="!editandoEquipamento[categoria]?.[i]">
                                <div class="equipment-header">
                                    <strong>{{equipamento.nome}}</strong>
                                    <div>
                                        <button type="button" class="btn btn-outline-info btn-sm me-1" (click)="toggleEditarEquipamento(categoria, i)">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button type="button" class="btn btn-danger btn-sm" (click)="removerEquipamento(categoria, equipamento)">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                    </div>
                                </div>
                                <p class="equipment-description">{{equipamento.descricao}}</p>
                                <p *ngIf="equipamento.ca" class="equipment-ca">
                                    <i class="fas fa-shield-alt text-primary me-1"></i><strong>CA:</strong> {{equipamento.ca}}
                                </p>
                            </div>
                            <div *ngIf="editandoEquipamento[categoria]?.[i]" class="edit-form">
                                <div class="row g-2">
                                    <div class="col-md-4">
                                        <input type="text" class="form-control" placeholder="Nome" [(ngModel)]="equipamento.nome" (change)="saveToCache()">
                                    </div>
                                    <div class="col-md-4">
                                        <input type="text" class="form-control" placeholder="Descrição" [(ngModel)]="equipamento.descricao" (change)="saveToCache()">
                                    </div>
                                    <div class="col-md-2">
                                        <input type="number" class="form-control" placeholder="CA" [(ngModel)]="equipamento.ca" (change)="saveToCache()">
                                    </div>
                                    <div class="col-md-2">
                                        <button type="button" class="btn btn-success btn-sm w-100" (click)="toggleEditarEquipamento(categoria, i)">
                                            <i class="fas fa-check"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div *ngIf="!hasEquipment()" class="text-muted text-center py-3">
                    <i class="fas fa-shield-alt fa-2x mb-2"></i>
                    <p>Nenhum equipamento adicionado</p>
                </div>
                <div *ngIf="adicionandoEquipamento" class="add-form mt-3">
                    <div class="row g-2">
                        <div class="col-md-2">
                            <select class="form-select" [(ngModel)]="novaCategoria">
                                <option value="" disabled selected>Categoria</option>
                                <option value="cabeca">Cabeça</option>
                                <option value="armadura">Armadura</option>
                                <option value="pes">Pés</option>
                                <option value="escudo">Escudo</option>
                                <option value="amuleto">Amuleto</option>
                                <option value="anel">Anel</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <input type="text" class="form-control" placeholder="Nome" [(ngModel)]="novoEquipamento.nome">
                        </div>
                        <div class="col-md-3">
                            <input type="text" class="form-control" placeholder="Descrição" [(ngModel)]="novoEquipamento.descricao">
                        </div>
                        <div class="col-md-2">
                            <input type="number" class="form-control" placeholder="CA" [(ngModel)]="novoEquipamento.ca">
                        </div>
                        <div class="col-md-3">
                            <button type="button" class="btn btn-success btn-sm w-100" (click)="confirmarAdicionarEquipamento()">
                                <i class="fas fa-check"></i> Confirmar
                            </button>
                            <button type="button" class="btn btn-danger btn-sm w-100 mt-1" (click)="cancelarAdicionarEquipamento()">
                                <i class="fas fa-times"></i> Cancelar
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Perícias -->
    <div class="collapse" id="collapsePericias">
        <div class="card shadow-sm mb-3">
            <div class="card-header bg-secondary text-white">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="fas fa-tasks me-2"></i>Perícias</h5>
                    <button type="button" class="btn btn-light btn-sm" (click)="toggleEditarPericias()">
                        <i class="fas" [ngClass]="editandoPericias ? 'fa-check' : 'fa-edit'" [title]="editandoPericias ? 'Salvar' : 'Editar'"></i>
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div *ngIf="!editandoPericias">
                    <div class="skills-grid">
                        <div class="skill-badge" *ngFor="let pericia of jogador.pericias">
                            <span *ngIf="pericia.valor === 'sim'" class="badge bg-success">
                                <i class="fas fa-check-circle me-1"></i>{{pericia.nome}}
                            </span>
                        </div>
                    </div>
                    <div *ngIf="!hasProficiencies()" class="text-muted text-center py-3">
                        <i class="fas fa-tasks fa-2x mb-2"></i>
                        <p>Nenhuma perícia selecionada</p>
                    </div>
                </div>
                <div *ngIf="editandoPericias" class="skills-checklist">
                    <div class="row g-2">
                        <div class="col-md-6" *ngFor="let pericia of jogador.pericias">
                            <div class="form-check skill-check">
                                <input class="form-check-input" type="checkbox"
                                    [checked]="pericia.valor === 'sim'"
                                    (change)="updatePericiaValor($event, pericia); saveToCache()"
                                    [id]="'pericia_' + pericia.nome" name="pericia_{{pericia.nome}}">
                                <label class="form-check-label" [for]="'pericia_' + pericia.nome">
                                    <i class="fas fa-check-circle me-1"></i>{{ pericia.nome }}
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Condições -->
    <div class="collapse" id="collapseCondicoes">
        <div class="card shadow-sm mb-3">
            <div class="card-header bg-danger text-white">
                <h5 class="mb-0"><i class="fas fa-heart-broken me-2"></i>Condições</h5>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-4 col-sm-6">
                        <div class="condition-box">
                            <i class="fas fa-utensils text-warning"></i>
                            <label>Fome</label>
                            <input type="number" class="form-control" [(ngModel)]="jogador.fome" (change)="saveToCache()">
                        </div>
                    </div>
                    <div class="col-md-4 col-sm-6">
                        <div class="condition-box">
                            <i class="fas fa-tint text-info"></i>
                            <label>Sede</label>
                            <input type="number" class="form-control" [(ngModel)]="jogador.sede" (change)="saveToCache()">
                        </div>
                    </div>
                    <div class="col-md-4 col-sm-6">
                        <div class="condition-box">
                            <i class="fas fa-tired text-secondary"></i>
                            <label>Cansaço</label>
                            <input type="number" class="form-control" [(ngModel)]="jogador.cansaco" (change)="saveToCache()">
                        </div>
                    </div>
                    <div class="col-md-4 col-sm-6">
                        <div class="condition-box">
                            <i class="fas fa-sun text-danger"></i>
                            <label>Calor</label>
                            <input type="number" class="form-control" [(ngModel)]="jogador.calor" (change)="saveToCache()">
                        </div>
                    </div>
                    <div class="col-md-4 col-sm-6">
                        <div class="condition-box">
                            <i class="fas fa-snowflake text-primary"></i>
                            <label>Frio</label>
                            <input type="number" class="form-control" [(ngModel)]="jogador.frio" (change)="saveToCache()">
                        </div>
                    </div>
                    <div class="col-md-4 col-sm-6">
                        <div class="condition-box">
                            <i class="fas fa-bed text-dark"></i>
                            <label>Sono</label>
                            <input type="number" class="form-control" [(ngModel)]="jogador.sono" (change)="saveToCache()">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Dialog -->
    <div *ngIf="confirmandoLimparCache" class="confirmation-overlay">
        <div class="confirmation-dialog card shadow-lg">
            <div class="card-body text-center">
                <i class="fas fa-exclamation-triangle fa-3x text-warning mb-3"></i>
                <h5><strong>Tem certeza que deseja apagar todos os dados do jogador?</strong></h5>
                <p class="text-muted">Esta ação não pode ser desfeita!</p>
                <div class="mt-3">
                    <button class="btn btn-success me-2" (click)="limparCache()">
                        <i class="fas fa-check me-1"></i>Sim, apagar
                    </button>
                    <button class="btn btn-secondary" (click)="cancelarLimparCache()">
                        <i class="fas fa-times me-1"></i>Cancelar
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="editarFichaModal" tabindex="-1" aria-labelledby="editarFichaModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content rpg-modal">
            <div class="modal-header bg-gradient-primary">
                <h5 class="modal-title" id="editarFichaModalLabel">
                    <i class="fas fa-scroll me-2"></i>Editar Ficha do Jogador
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form>
                    <!-- Basic Info Section -->
                    <div class="form-section">
                        <h6 class="section-heading">
                            <i class="fas fa-user me-2"></i>Informações Básicas
                        </h6>
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label for="nome" class="form-label">
                                    <i class="fas fa-signature me-1"></i>Nome
                                </label>
                                <input type="text" class="form-control" id="nome" [(ngModel)]="jogador.nome" name="nome" placeholder="Nome do personagem">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">
                                    <i class="fas fa-hat-wizard me-1"></i>Classe
                                </label>
                                <div class="current-selection mb-2" *ngIf="jogador.classe">
                                    <span class="badge bg-primary">{{ jogador.classe }}</span>
                                </div>
                                <button class="btn btn-outline-primary btn-sm w-100" type="button"
                                    (click)="openClassSelection()">
                                    <i class="fas fa-search me-1"></i>{{ jogador.classe ? 'Trocar Classe' : 'Selecionar Classe' }}
                                </button>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">
                                    <i class="fas fa-users me-1"></i>Raça
                                </label>
                                <div class="current-selection mb-2" *ngIf="jogador.raca">
                                    <span class="badge bg-success">{{ jogador.raca }}</span>
                                </div>
                                <button class="btn btn-outline-success btn-sm w-100" type="button"
                                    (click)="openRaceSelection()">
                                    <i class="fas fa-search me-1"></i>{{ jogador.raca ? 'Trocar Raça' : 'Selecionar Raça' }}
                                </button>
                            </div>
                            <div class="col-md-6">
                                <label for="proficiencia" class="form-label">
                                    <i class="fas fa-certificate me-1"></i>Bônus de Proficiência
                                </label>
                                <input type="number" class="form-control" id="proficiencia" [(ngModel)]="jogador.proficiencia"
                                    name="proficiencia" placeholder="Ex: 2">
                            </div>
                            <div class="col-md-6">
                                <label for="nivel" class="form-label">
                                    <i class="fas fa-level-up-alt me-1"></i>Nível
                                </label>
                                <input type="number" class="form-control" id="nivel" [(ngModel)]="jogador.nivel"
                                    name="nivel" placeholder="Ex: 1">
                            </div>
                        </div>
                    </div>

                    <!-- Combat Stats Section -->
                    <div class="form-section">
                        <h6 class="section-heading">
                            <i class="fas fa-shield-alt me-2"></i>Estatísticas de Combate
                        </h6>
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label for="pv" class="form-label">
                                    <i class="fas fa-heart me-1"></i>Pontos de Vida (PV)
                                </label>
                                <input type="number" class="form-control" id="pv" [(ngModel)]="jogador.pv" name="pv" placeholder="Ex: 10">
                            </div>
                            <div class="col-md-4">
                                <label for="pva" class="form-label">
                                    <i class="fas fa-heartbeat me-1"></i>PV Atual
                                </label>
                                <input type="number" class="form-control" id="pva" [(ngModel)]="jogador.pva" name="pva" placeholder="Ex: 10">
                            </div>
                            <div class="col-md-4">
                                <label for="ca" class="form-label">
                                    <i class="fas fa-shield me-1"></i>Classe de Armadura (CA)
                                </label>
                                <input type="number" class="form-control" id="ca" [value]="caCalculada" name="ca" readonly>
                                <small class="text-muted">Calculado automaticamente baseado nos equipamentos</small>
                            </div>
                            <div class="col-md-4">
                                <label for="deslocamento" class="form-label">
                                    <i class="fas fa-running me-1"></i>Deslocamento
                                </label>
                                <input type="number" class="form-control" id="deslocamento"
                                    [(ngModel)]="jogador.deslocamento" name="deslocamento" placeholder="Ex: 30">
                            </div>
                            <div class="col-md-4">
                                <label for="iniciativa" class="form-label">
                                    <i class="fas fa-bolt me-1"></i>Iniciativa
                                </label>
                                <input type="number" class="form-control" id="iniciativa" [(ngModel)]="jogador.iniciativa"
                                    name="iniciativa" placeholder="Ex: 2">
                            </div>
                            <div class="col-md-4">
                                <label for="inspiracao" class="form-label">
                                    <i class="fas fa-star me-1"></i>Inspiração
                                </label>
                                <input type="number" class="form-control" id="inspiracao" [(ngModel)]="jogador.inspiracao"
                                    name="inspiracao" placeholder="Ex: 0">
                            </div>
                        </div>
                    </div>

                    <!-- Attributes Section -->
                    <div class="form-section">
                        <h6 class="section-heading">
                            <i class="fas fa-dumbbell me-2"></i>Atributos
                        </h6>
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label for="forca" class="form-label">
                                    <i class="fas fa-fist-raised me-1"></i>Força
                                </label>
                                <input type="number" inputmode="decimal" class="form-control" id="forca" [(ngModel)]="jogador.atributos.forca"
                                    name="forca" placeholder="Ex: 10">
                            </div>
                            <div class="col-md-4">
                                <label for="destreza" class="form-label">
                                    <i class="fas fa-running me-1"></i>Destreza
                                </label>
                                <input type="number" inputmode="decimal" class="form-control" id="destreza"
                                    [(ngModel)]="jogador.atributos.destreza" name="destreza" placeholder="Ex: 10">
                            </div>
                            <div class="col-md-4">
                                <label for="constituicao" class="form-label">
                                    <i class="fas fa-heart me-1"></i>Constituição
                                </label>
                                <input type="number" inputmode="decimal" class="form-control" id="constituicao"
                                    [(ngModel)]="jogador.atributos.constituicao" name="constituicao" placeholder="Ex: 10">
                            </div>
                            <div class="col-md-4">
                                <label for="inteligencia" class="form-label">
                                    <i class="fas fa-brain me-1"></i>Inteligência
                                </label>
                                <input type="number" inputmode="decimal" class="form-control" id="inteligencia"
                                    [(ngModel)]="jogador.atributos.inteligencia" name="inteligencia" placeholder="Ex: 10">
                            </div>
                            <div class="col-md-4">
                                <label for="sabedoria" class="form-label">
                                    <i class="fas fa-eye me-1"></i>Sabedoria
                                </label>
                                <input type="number" inputmode="decimal" class="form-control" id="sabedoria"
                                    [(ngModel)]="jogador.atributos.sabedoria" name="sabedoria" placeholder="Ex: 10">
                            </div>
                            <div class="col-md-4">
                                <label for="carisma" class="form-label">
                                    <i class="fas fa-comments me-1"></i>Carisma
                                </label>
                                <input type="number" inputmode="decimal" class="form-control" id="carisma"
                                    [(ngModel)]="jogador.atributos.carisma" name="carisma" placeholder="Ex: 10">
                            </div>
                        </div>
                    </div>

                    <!-- Skills Section -->
                    <div class="form-section">
                        <h6 class="section-heading">
                            <i class="fas fa-tasks me-2"></i>Perícias
                        </h6>
                        <div class="skills-checklist">
                            <div class="row g-2">
                                <div class="col-md-6" *ngFor="let pericia of jogador.pericias">
                                    <div class="form-check skill-check">
                                        <input class="form-check-input" type="checkbox"
                                            [checked]="pericia.valor === 'sim'"
                                            (change)="updatePericiaValor($event, pericia); saveToCache()"
                                            [id]="'pericia_' + pericia.nome" name="pericia_{{pericia.nome}}">
                                        <label class="form-check-label" [for]="'pericia_' + pericia.nome">
                                            <i class="fas fa-check-circle me-1"></i>{{ pericia.nome }}
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>Cancelar
                </button>
                <button type="button" class="btn btn-primary" (click)="saveToCache()" data-bs-dismiss="modal">
                    <i class="fas fa-save me-2"></i>Salvar Alterações
                </button>
            </div>
        </div>
    </div>
</div>
<!-- Class Details Modal -->
<div class="modal fade" id="classDetailsModal" tabindex="-1" aria-labelledby="classDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content rpg-modal">
            <div class="modal-header bg-gradient-primary">
                <h5 class="modal-title" id="classDetailsModalLabel">
                    <i class="fas fa-hat-wizard me-2"></i>Detalhes da Classe
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div *ngIf="loadingClassDetails" class="text-center py-4">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Carregando...</span>
                    </div>
                    <p class="mt-2 text-muted">Carregando detalhes da classe...</p>
                </div>
                <div *ngIf="!loadingClassDetails && selectedClassDetails">
                    <h4 class="mb-3">{{ selectedClassDetails.name }}</h4>

                    <div class="detail-section mb-3" *ngIf="selectedClassDetails.hit_die">
                        <h6 class="text-primary"><i class="fas fa-dice-d20 me-2"></i>Dado de Vida</h6>
                        <p>d{{ selectedClassDetails.hit_die }}</p>
                    </div>

                    <div class="detail-section mb-3" *ngIf="selectedClassDetails.proficiencies && selectedClassDetails.proficiencies.length > 0">
                        <h6 class="text-primary"><i class="fas fa-check-circle me-2"></i>Proficiências</h6>
                        <ul class="mb-0">
                            <li *ngFor="let prof of selectedClassDetails.proficiencies">{{ prof.name }}</li>
                        </ul>
                    </div>

                    <div class="detail-section mb-3" *ngIf="selectedClassDetails.saving_throws && selectedClassDetails.saving_throws.length > 0">
                        <h6 class="text-primary"><i class="fas fa-shield-alt me-2"></i>Testes de Resistência</h6>
                        <ul class="mb-0">
                            <li *ngFor="let save of selectedClassDetails.saving_throws">{{ save.name }}</li>
                        </ul>
                    </div>

                    <div class="detail-section mb-3" *ngIf="selectedClassDetails.subclasses && selectedClassDetails.subclasses.length > 0">
                        <h6 class="text-primary"><i class="fas fa-sitemap me-2"></i>Subclasses</h6>
                        <ul class="mb-0">
                            <li *ngFor="let subclass of selectedClassDetails.subclasses">{{ subclass.name }}</li>
                        </ul>
                    </div>

                    <div class="detail-section mb-3" *ngIf="selectedClassDetails.spellcasting">
                        <h6 class="text-primary"><i class="fas fa-magic me-2"></i>Conjuração</h6>
                        <p class="mb-0">Esta classe possui habilidades de conjuração</p>
                    </div>
                </div>
                <div *ngIf="!loadingClassDetails && !selectedClassDetails" class="text-center py-4 text-muted">
                    <i class="fas fa-exclamation-circle fa-2x mb-2"></i>
                    <p>Nenhuma classe selecionada</p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" (click)="closeClassDetails()">
                    <i class="fas fa-times me-2"></i>Fechar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Race Details Modal -->
<div class="modal fade" id="raceDetailsModal" tabindex="-1" aria-labelledby="raceDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content rpg-modal">
            <div class="modal-header bg-gradient-primary">
                <h5 class="modal-title" id="raceDetailsModalLabel">
                    <i class="fas fa-users me-2"></i>Detalhes da Raça
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div *ngIf="loadingRaceDetails" class="text-center py-4">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Carregando...</span>
                    </div>
                    <p class="mt-2 text-muted">Carregando detalhes da raça...</p>
                </div>
                <div *ngIf="!loadingRaceDetails && selectedRaceDetails">
                    <h4 class="mb-3">{{ selectedRaceDetails.name }}</h4>

                    <div class="detail-section mb-3" *ngIf="selectedRaceDetails.speed">
                        <h6 class="text-primary"><i class="fas fa-running me-2"></i>Velocidade</h6>
                        <p>{{ selectedRaceDetails.speed }} pés</p>
                    </div>

                    <div class="detail-section mb-3" *ngIf="selectedRaceDetails.ability_bonuses && selectedRaceDetails.ability_bonuses.length > 0">
                        <h6 class="text-primary"><i class="fas fa-arrow-up me-2"></i>Bônus de Atributos</h6>
                        <ul class="mb-0">
                            <li *ngFor="let bonus of selectedRaceDetails.ability_bonuses">
                                {{ bonus.ability_score.name }}: +{{ bonus.bonus }}
                            </li>
                        </ul>
                    </div>

                    <div class="detail-section mb-3" *ngIf="selectedRaceDetails.age">
                        <h6 class="text-primary"><i class="fas fa-hourglass-half me-2"></i>Idade</h6>
                        <p>{{ selectedRaceDetails.age }}</p>
                    </div>

                    <div class="detail-section mb-3" *ngIf="selectedRaceDetails.alignment">
                        <h6 class="text-primary"><i class="fas fa-balance-scale me-2"></i>Tendência</h6>
                        <p>{{ selectedRaceDetails.alignment }}</p>
                    </div>

                    <div class="detail-section mb-3" *ngIf="selectedRaceDetails.size">
                        <h6 class="text-primary"><i class="fas fa-ruler me-2"></i>Tamanho</h6>
                        <p>{{ selectedRaceDetails.size }}</p>
                        <p *ngIf="selectedRaceDetails.size_description" class="text-muted small">
                            {{ selectedRaceDetails.size_description }}
                        </p>
                    </div>

                    <div class="detail-section mb-3" *ngIf="selectedRaceDetails.languages && selectedRaceDetails.languages.length > 0">
                        <h6 class="text-primary"><i class="fas fa-language me-2"></i>Idiomas</h6>
                        <ul class="mb-0">
                            <li *ngFor="let lang of selectedRaceDetails.languages">{{ lang.name }}</li>
                        </ul>
                        <p *ngIf="selectedRaceDetails.language_desc" class="text-muted small mt-2">
                            {{ selectedRaceDetails.language_desc }}
                        </p>
                    </div>

                    <div class="detail-section mb-3" *ngIf="selectedRaceDetails.traits && selectedRaceDetails.traits.length > 0">
                        <h6 class="text-primary"><i class="fas fa-star me-2"></i>Traços Raciais</h6>
                        <ul class="mb-0">
                            <li *ngFor="let trait of selectedRaceDetails.traits">{{ trait.name }}</li>
                        </ul>
                    </div>

                    <div class="detail-section mb-3" *ngIf="selectedRaceDetails.subraces && selectedRaceDetails.subraces.length > 0">
                        <h6 class="text-primary"><i class="fas fa-sitemap me-2"></i>Sub-raças</h6>
                        <ul class="mb-0">
                            <li *ngFor="let subrace of selectedRaceDetails.subraces">{{ subrace.name }}</li>
                        </ul>
                    </div>
                </div>
                <div *ngIf="!loadingRaceDetails && !selectedRaceDetails" class="text-center py-4 text-muted">
                    <i class="fas fa-exclamation-circle fa-2x mb-2"></i>
                    <p>Nenhuma raça selecionada</p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" (click)="closeRaceDetails()">
                    <i class="fas fa-times me-2"></i>Fechar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Class Selection Modal -->
<div class="modal fade" id="classSelectionModal" tabindex="-1" aria-labelledby="classSelectionModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
        <div class="modal-content rpg-modal">
            <div class="modal-header bg-gradient-primary">
                <h5 class="modal-title" id="classSelectionModalLabel">
                    <i class="fas fa-hat-wizard me-2"></i>Selecionar Classe
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row g-3">
                    <div class="col-md-6 col-lg-4" *ngFor="let classe of availableClasses">
                        <div class="card selection-card h-100"
                            [class.selected]="jogador.classe === classe.name">
                            <div class="card-body text-center">
                                <h5 class="card-title">
                                    <i class="fas fa-hat-wizard me-2"></i>{{ classe.name }}
                                </h5>
                                <div class="d-flex gap-2 justify-content-center mt-2">
                                    <button class="btn btn-sm btn-outline-primary" type="button"
                                        (click)="selectClass(classe)">
                                        <i class="fas fa-check me-1"></i>Selecionar
                                    </button>
                                    <button class="btn btn-sm btn-outline-info" type="button"
                                        (click)="viewClassDetails(classe.index)">
                                        <i class="fas fa-info-circle me-1"></i>Detalhes
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div *ngIf="availableClasses.length === 0" class="text-center py-4 text-muted">
                    <i class="fas fa-spinner fa-spin fa-2x mb-2"></i>
                    <p>Carregando classes...</p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>Fechar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Race Selection Modal -->
<div class="modal fade" id="raceSelectionModal" tabindex="-1" aria-labelledby="raceSelectionModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
        <div class="modal-content rpg-modal">
            <div class="modal-header bg-gradient-success">
                <h5 class="modal-title" id="raceSelectionModalLabel">
                    <i class="fas fa-users me-2"></i>Selecionar Raça
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row g-3">
                    <div class="col-md-6 col-lg-4" *ngFor="let raca of availableRaces">
                        <div class="card selection-card h-100"
                            [class.selected]="jogador.raca === raca.name">
                            <div class="card-body text-center">
                                <h5 class="card-title">
                                    <i class="fas fa-users me-2"></i>{{ raca.name }}
                                </h5>
                                <div class="d-flex gap-2 justify-content-center mt-2">
                                    <button class="btn btn-sm btn-outline-success" type="button"
                                        (click)="selectRace(raca)">
                                        <i class="fas fa-check me-1"></i>Selecionar
                                    </button>
                                    <button class="btn btn-sm btn-outline-info" type="button"
                                        (click)="viewRaceDetails(raca.index)">
                                        <i class="fas fa-info-circle me-1"></i>Detalhes
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div *ngIf="availableRaces.length === 0" class="text-center py-4 text-muted">
                    <i class="fas fa-spinner fa-spin fa-2x mb-2"></i>
                    <p>Carregando raças...</p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>Fechar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Spell Search Modal -->
<div class="modal fade" [class.show]="buscarMagiaAberto" [style.display]="buscarMagiaAberto ? 'block' : 'none'" tabindex="-1" aria-labelledby="spellSearchModalLabel" [attr.aria-hidden]="!buscarMagiaAberto">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
        <div class="modal-content rpg-modal">
            <div class="modal-header bg-gradient-primary">
                <h5 class="modal-title" id="spellSearchModalLabel">
                    <i class="fas fa-magic me-2"></i>Buscar Magias - D&D 5e API
                </h5>
                <button type="button" class="btn-close btn-close-white" (click)="fecharBuscarMagia()" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- List View -->
                <div *ngIf="!selectedSpellDetails">
                    <!-- Filtros -->
                    <div class="row g-3 mb-3">
                        <div class="col-md-4">
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-search"></i></span>
                                <input type="text" class="form-control" placeholder="Buscar magia..."
                                       [(ngModel)]="spellSearchTerm" (input)="filtrarMagias()">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <select class="form-select" [(ngModel)]="spellLevelFilter" (change)="aplicarFiltrosMagias()">
                                <option value="">Todos os Níveis</option>
                                <option value="0">Truque (0)</option>
                                <option *ngFor="let level of availableSpellLevels.slice(1)" [value]="level">
                                    Nível {{ level }}
                                </option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <select class="form-select" [(ngModel)]="spellClassFilter" (change)="aplicarFiltrosMagias()">
                                <option value="">Todas as Classes</option>
                                <option *ngFor="let classType of availableSpellClasses" [value]="classType">
                                    {{ classType }}
                                </option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <button type="button" class="btn btn-outline-secondary w-100" (click)="limparFiltrosMagias()"
                                    [disabled]="!spellLevelFilter && !spellClassFilter && !spellSearchTerm">
                                <i class="fas fa-times me-1"></i>Limpar
                            </button>
                        </div>
                    </div>

                    <div *ngIf="loadingSpells" class="text-center py-4">
                        <i class="fas fa-spinner fa-spin fa-2x mb-2"></i>
                        <p>Carregando magias...</p>
                    </div>

                    <div *ngIf="!loadingSpells" class="row g-3">
                        <div class="col-md-6 col-lg-4" *ngFor="let spell of filteredSpells">
                            <div class="card h-100 hover-card">
                                <div class="card-body">
                                    <h6 class="card-title">
                                        <i class="fas fa-wand-magic text-primary me-2"></i>{{ spell.name }}
                                    </h6>
                                    <div class="d-flex justify-content-between mt-3">
                                        <button type="button" class="btn btn-sm btn-outline-primary"
                                                (click)="viewSpellDetails(spell.index)">
                                            <i class="fas fa-info-circle me-1"></i>Detalhes
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div *ngIf="!loadingSpells && filteredSpells.length === 0" class="text-center py-4 text-muted">
                        <i class="fas fa-search fa-2x mb-2"></i>
                        <p>Nenhuma magia encontrada</p>
                    </div>
                </div>

                <!-- Details View -->
                <div *ngIf="selectedSpellDetails">
                    <button type="button" class="btn btn-sm btn-outline-secondary mb-3" (click)="voltarListaMagias()">
                        <i class="fas fa-arrow-left me-1"></i>Voltar
                    </button>

                    <h4 class="mb-3">
                        <i class="fas fa-wand-magic text-primary me-2"></i>{{ selectedSpellDetails.name }}
                    </h4>

                    <div class="detail-section mb-3" *ngIf="selectedSpellDetails.level !== undefined">
                        <h6 class="text-primary"><i class="fas fa-layer-group me-2"></i>Nível</h6>
                        <p>{{ selectedSpellDetails.level === 0 ? 'Truque' : 'Nível ' + selectedSpellDetails.level }}</p>
                    </div>

                    <div class="detail-section mb-3" *ngIf="selectedSpellDetails.school">
                        <h6 class="text-primary"><i class="fas fa-book me-2"></i>Escola</h6>
                        <p>{{ selectedSpellDetails.school.name }}</p>
                    </div>

                    <div class="detail-section mb-3" *ngIf="selectedSpellDetails.casting_time">
                        <h6 class="text-primary"><i class="fas fa-clock me-2"></i>Tempo de Conjuração</h6>
                        <p>{{ selectedSpellDetails.casting_time }}</p>
                    </div>

                    <div class="detail-section mb-3" *ngIf="selectedSpellDetails.range">
                        <h6 class="text-primary"><i class="fas fa-crosshairs me-2"></i>Alcance</h6>
                        <p>{{ selectedSpellDetails.range }}</p>
                    </div>

                    <div class="detail-section mb-3" *ngIf="selectedSpellDetails.components && selectedSpellDetails.components.length > 0">
                        <h6 class="text-primary"><i class="fas fa-hand-sparkles me-2"></i>Componentes</h6>
                        <p>{{ selectedSpellDetails.components.join(', ') }}</p>
                        <p *ngIf="selectedSpellDetails.material" class="text-muted small">{{ selectedSpellDetails.material }}</p>
                    </div>

                    <div class="detail-section mb-3" *ngIf="selectedSpellDetails.duration">
                        <h6 class="text-primary"><i class="fas fa-hourglass-half me-2"></i>Duração</h6>
                        <p>{{ selectedSpellDetails.duration }}</p>
                    </div>

                    <div class="detail-section mb-3" *ngIf="selectedSpellDetails.desc && selectedSpellDetails.desc.length > 0">
                        <h6 class="text-primary"><i class="fas fa-scroll me-2"></i>Descrição</h6>
                        <p *ngFor="let paragraph of selectedSpellDetails.desc">{{ paragraph }}</p>
                    </div>

                    <div class="detail-section mb-3" *ngIf="selectedSpellDetails.higher_level && selectedSpellDetails.higher_level.length > 0">
                        <h6 class="text-primary"><i class="fas fa-arrow-up me-2"></i>Em Níveis Superiores</h6>
                        <p *ngFor="let paragraph of selectedSpellDetails.higher_level">{{ paragraph }}</p>
                    </div>

                    <div class="detail-section mb-3" *ngIf="selectedSpellDetails.classes && selectedSpellDetails.classes.length > 0">
                        <h6 class="text-primary"><i class="fas fa-hat-wizard me-2"></i>Classes</h6>
                        <ul class="mb-0">
                            <li *ngFor="let cls of selectedSpellDetails.classes">{{ cls.name }}</li>
                        </ul>
                    </div>

                    <button type="button" class="btn btn-primary mt-3" (click)="adicionarMagiaApi(selectedSpellDetails)">
                        <i class="fas fa-plus me-2"></i>Adicionar à Ficha
                    </button>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" (click)="fecharBuscarMagia()">
                    <i class="fas fa-times me-2"></i>Fechar
                </button>
            </div>
        </div>
    </div>
</div>
<div class="modal-backdrop fade" [class.show]="buscarMagiaAberto" *ngIf="buscarMagiaAberto"></div>

<!-- Feat Search Modal -->
<div class="modal fade" [class.show]="buscarTalentoAberto" [style.display]="buscarTalentoAberto ? 'block' : 'none'" tabindex="-1" aria-labelledby="featSearchModalLabel" [attr.aria-hidden]="!buscarTalentoAberto">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
        <div class="modal-content rpg-modal">
            <div class="modal-header bg-gradient-success">
                <h5 class="modal-title text-white" id="featSearchModalLabel">
                    <i class="fas fa-star me-2"></i>Buscar Talentos - D&D 5e API
                </h5>
                <button type="button" class="btn-close btn-close-white" (click)="fecharBuscarTalento()" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- List View -->
                <div *ngIf="!selectedFeatDetails">
                    <div class="mb-3">
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-search"></i></span>
                            <input type="text" class="form-control" placeholder="Buscar talento..."
                                   [(ngModel)]="featSearchTerm" (input)="filtrarTalentos()">
                        </div>
                    </div>

                    <div *ngIf="loadingFeats" class="text-center py-4">
                        <i class="fas fa-spinner fa-spin fa-2x mb-2"></i>
                        <p>Carregando talentos...</p>
                    </div>

                    <div *ngIf="!loadingFeats" class="row g-3">
                        <div class="col-md-6 col-lg-4" *ngFor="let feat of filteredFeats">
                            <div class="card h-100 hover-card">
                                <div class="card-body">
                                    <h6 class="card-title">
                                        <i class="fas fa-certificate text-success me-2"></i>{{ feat.name }}
                                    </h6>
                                    <p class="card-text small text-muted" *ngIf="getFeatDescPreview(feat)">
                                        {{ getFeatDescPreview(feat) }}
                                    </p>
                                    <div class="d-flex justify-content-between mt-3">
                                        <button type="button" class="btn btn-sm btn-outline-success"
                                                (click)="viewFeatDetails(getFeatId(feat))">
                                            <i class="fas fa-info-circle me-1"></i>Detalhes
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div *ngIf="!loadingFeats && filteredFeats.length === 0" class="text-center py-4 text-muted">
                        <i class="fas fa-search fa-2x mb-2"></i>
                        <p>Nenhum talento encontrado</p>
                    </div>
                </div>

                <!-- Details View -->
                <div *ngIf="selectedFeatDetails">
                    <button type="button" class="btn btn-sm btn-outline-secondary mb-3" (click)="voltarListaTalentos()">
                        <i class="fas fa-arrow-left me-1"></i>Voltar
                    </button>

                    <h4 class="mb-3">
                        <i class="fas fa-certificate text-success me-2"></i>{{ selectedFeatDetails.name }}
                    </h4>

                    <div class="detail-section mb-3" *ngIf="selectedFeatDetails.prerequisites && selectedFeatDetails.prerequisites.length > 0">
                        <h6 class="text-success"><i class="fas fa-exclamation-triangle me-2"></i>Pré-requisitos</h6>
                        <ul class="mb-0">
                            <li *ngFor="let prereq of selectedFeatDetails.prerequisites">
                                {{ prereq.ability_score?.name || prereq || 'Pré-requisito' }}: {{ prereq.minimum_score || '' }}
                            </li>
                        </ul>
                    </div>

                    <!-- Prerequisito como string (Open5e) -->
                    <div class="detail-section mb-3" *ngIf="selectedFeatDetails.prerequisite && !selectedFeatDetails.prerequisites">
                        <h6 class="text-success"><i class="fas fa-exclamation-triangle me-2"></i>Pré-requisito</h6>
                        <p>{{ selectedFeatDetails.prerequisite }}</p>
                    </div>

                    <div class="detail-section mb-3" *ngIf="selectedFeatDetails.desc && selectedFeatDetails.desc.length > 0">
                        <h6 class="text-success"><i class="fas fa-scroll me-2"></i>Descrição</h6>
                        <p *ngFor="let paragraph of selectedFeatDetails.desc">{{ paragraph }}</p>
                    </div>

                    <!-- Descrição como string simples (Open5e) -->
                    <div class="detail-section mb-3" *ngIf="selectedFeatDetails.desc && isString(selectedFeatDetails.desc)">
                        <h6 class="text-success"><i class="fas fa-scroll me-2"></i>Descrição</h6>
                        <div [innerHTML]="selectedFeatDetails.desc"></div>
                    </div>

                    <button type="button" class="btn btn-success mt-3" (click)="adicionarTalentoApi(selectedFeatDetails)">
                        <i class="fas fa-plus me-2"></i>Adicionar à Ficha
                    </button>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" (click)="fecharBuscarTalento()">
                    <i class="fas fa-times me-2"></i>Fechar
                </button>
            </div>
        </div>
    </div>
</div>
<div class="modal-backdrop fade" [class.show]="buscarTalentoAberto" *ngIf="buscarTalentoAberto"></div>
