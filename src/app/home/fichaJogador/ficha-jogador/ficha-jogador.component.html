<div class="character-sheet-container">
    <!-- Character Header -->
    <div class="character-header card shadow-lg mb-4">
        <div class="card-body">
            <div class="row align-items-center">
                <div class="col-md-3 text-center mb-3 mb-md-0">
                    <div class="avatar-container">
                        <img [src]="jogador.avatar" alt="Avatar do jogador" class="avatar-img">
                        <div class="avatar-overlay">
                            <i class="fas fa-user-circle"></i>
                        </div>
                    </div>
                </div>
                <div class="col-md-9">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <h2 class="character-name mb-2">
                                <i class="fas fa-user-shield me-2"></i>{{jogador.nome || 'Sem Nome'}}
                            </h2>
                            <div class="character-details">
                                <span class="detail-badge">
                                    <i class="fas fa-hat-wizard me-1"></i>{{jogador.classe || 'Classe'}}
                                </span>
                                <span class="detail-badge">
                                    <i class="fas fa-users me-1"></i>{{jogador.raca || 'Raça'}}
                                </span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="row g-2">
                                <div class="col-6">
                                    <div class="stat-mini">
                                        <i class="fas fa-level-up-alt"></i>
                                        <span class="stat-label">Nível</span>
                                        <span class="stat-value">{{jogador.nivel || 0}}</span>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="stat-mini">
                                        <i class="fas fa-certificate"></i>
                                        <span class="stat-label">Proficiência</span>
                                        <span class="stat-value">+{{jogador.proficiencia || 0}}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="action-buttons-header mt-3">
                <button class="btn btn-warning btn-sm" type="button" data-bs-toggle="modal" data-bs-target="#editarFichaModal">
                    <i class="fas fa-edit me-1"></i>Editar Ficha
                </button>
                <button class="btn btn-info btn-sm" (click)="baixarJogador()">
                    <i class="fas fa-download me-1"></i>Baixar
                </button>
                <label class="btn btn-success btn-sm mb-0">
                    <i class="fas fa-upload me-1"></i>Carregar
                    <input type="file" class="d-none" (change)="carregarJogador($event)" accept=".json">
                </label>
                <button class="btn btn-danger btn-sm" (click)="confirmarLimparCache()">
                    <i class="fas fa-trash-alt me-1"></i>Limpar
                </button>
            </div>
        </div>
    </div>

    <!-- Combat Stats Section -->
    <div class="row mb-4">
        <div class="col-lg-6 mb-3">
            <div class="card shadow-sm combat-card">
                <div class="card-header bg-danger text-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="fas fa-heart-broken me-2"></i>Combate</h5>
                        <button type="button" class="btn btn-light btn-sm" (click)="toggleEditarCombate()">
                            <i class="fas" [ngClass]="editandoCombate ? 'fa-check' : 'fa-edit'" [title]="editandoCombate ? 'Salvar' : 'Editar'"></i>
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-4">
                            <div class="combat-stat">
                                <i class="fas fa-heart text-danger"></i>
                                <span class="stat-label">PV Máx</span>
                                <input *ngIf="editandoCombate" type="number" class="stat-input" [(ngModel)]="jogador.pv" (change)="saveToCache()">
                                <span *ngIf="!editandoCombate" class="stat-value">{{jogador.pv || 0}}</span>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="combat-stat active">
                                <i class="fas fa-heartbeat text-success"></i>
                                <span class="stat-label">PV Atual</span>
                                <input type="number" class="stat-input" [(ngModel)]="jogador.pva" (change)="saveToCache()">
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="combat-stat">
                                <i class="fas fa-shield-alt text-primary"></i>
                                <span class="stat-label">CA</span>
                                <input *ngIf="editandoCombate" type="number" class="stat-input" [(ngModel)]="jogador.ca" (change)="saveToCache()">
                                <span *ngIf="!editandoCombate" class="stat-value">{{jogador.ca || 0}}</span>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="combat-stat">
                                <i class="fas fa-running text-info"></i>
                                <span class="stat-label">Deslocamento</span>
                                <input *ngIf="editandoCombate" type="number" class="stat-input" [(ngModel)]="jogador.deslocamento" (change)="saveToCache()">
                                <span *ngIf="!editandoCombate" class="stat-value">{{jogador.deslocamento || 0}}</span>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="combat-stat">
                                <i class="fas fa-bolt text-warning"></i>
                                <span class="stat-label">Iniciativa</span>
                                <input *ngIf="editandoCombate" type="number" class="stat-input" [(ngModel)]="jogador.iniciativa" (change)="saveToCache()">
                                <span *ngIf="!editandoCombate" class="stat-value">+{{jogador.iniciativa || 0}}</span>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="combat-stat">
                                <i class="fas fa-star text-warning"></i>
                                <span class="stat-label">Inspiração</span>
                                <input *ngIf="editandoCombate" type="number" class="stat-input" [(ngModel)]="jogador.inspiracao" (change)="saveToCache()">
                                <span *ngIf="!editandoCombate" class="stat-value">{{jogador.inspiracao || 0}}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Attributes Section -->
        <div class="col-lg-6 mb-3">
            <div class="card shadow-sm attributes-card">
                <div class="card-header bg-primary text-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="fas fa-dumbbell me-2"></i>Atributos</h5>
                        <button type="button" class="btn btn-light btn-sm" (click)="toggleEditarAtributos()">
                            <i class="fas" [ngClass]="editandoAtributos ? 'fa-check' : 'fa-edit'" [title]="editandoAtributos ? 'Salvar' : 'Editar'"></i>
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row g-2">
                        <div class="col-4 col-md-4">
                            <div class="attribute-box">
                                <i class="fas fa-fist-raised"></i>
                                <span class="attr-name">FOR</span>
                                <input *ngIf="editandoAtributos" type="number" class="attr-input" [(ngModel)]="jogador.atributos.forca" (change)="saveToCache()">
                                <span *ngIf="!editandoAtributos" class="attr-value">{{jogador.atributos.forca || 10}}</span>
                                <span class="attr-modifier">{{ (calcularModificador(jogador.atributos.forca) ?? 0) >= 0 ? '+' : '' }}{{ calcularModificador(jogador.atributos.forca) ?? 0 }}</span>
                            </div>
                        </div>
                        <div class="col-4 col-md-4">
                            <div class="attribute-box">
                                <i class="fas fa-running"></i>
                                <span class="attr-name">DES</span>
                                <input *ngIf="editandoAtributos" type="number" class="attr-input" [(ngModel)]="jogador.atributos.destreza" (change)="saveToCache()">
                                <span *ngIf="!editandoAtributos" class="attr-value">{{jogador.atributos.destreza || 10}}</span>
                                <span class="attr-modifier">{{ (calcularModificador(jogador.atributos.destreza) ?? 0) >= 0 ? '+' : '' }}{{ calcularModificador(jogador.atributos.destreza) ?? 0 }}</span>
                            </div>
                        </div>
                        <div class="col-4 col-md-4">
                            <div class="attribute-box">
                                <i class="fas fa-heart"></i>
                                <span class="attr-name">CON</span>
                                <input *ngIf="editandoAtributos" type="number" class="attr-input" [(ngModel)]="jogador.atributos.constituicao" (change)="saveToCache()">
                                <span *ngIf="!editandoAtributos" class="attr-value">{{jogador.atributos.constituicao || 10}}</span>
                                <span class="attr-modifier">{{ (calcularModificador(jogador.atributos.constituicao) ?? 0) >= 0 ? '+' : '' }}{{ calcularModificador(jogador.atributos.constituicao) ?? 0 }}</span>
                            </div>
                        </div>
                        <div class="col-4 col-md-4">
                            <div class="attribute-box">
                                <i class="fas fa-brain"></i>
                                <span class="attr-name">INT</span>
                                <input *ngIf="editandoAtributos" type="number" class="attr-input" [(ngModel)]="jogador.atributos.inteligencia" (change)="saveToCache()">
                                <span *ngIf="!editandoAtributos" class="attr-value">{{jogador.atributos.inteligencia || 10}}</span>
                                <span class="attr-modifier">{{ (calcularModificador(jogador.atributos.inteligencia) ?? 0) >= 0 ? '+' : '' }}{{ calcularModificador(jogador.atributos.inteligencia) ?? 0 }}</span>
                            </div>
                        </div>
                        <div class="col-4 col-md-4">
                            <div class="attribute-box">
                                <i class="fas fa-eye"></i>
                                <span class="attr-name">SAB</span>
                                <input *ngIf="editandoAtributos" type="number" class="attr-input" [(ngModel)]="jogador.atributos.sabedoria" (change)="saveToCache()">
                                <span *ngIf="!editandoAtributos" class="attr-value">{{jogador.atributos.sabedoria || 10}}</span>
                                <span class="attr-modifier">{{ (calcularModificador(jogador.atributos.sabedoria) ?? 0) >= 0 ? '+' : '' }}{{ calcularModificador(jogador.atributos.sabedoria) ?? 0 }}</span>
                            </div>
                        </div>
                        <div class="col-4 col-md-4">
                            <div class="attribute-box">
                                <i class="fas fa-comments"></i>
                                <span class="attr-name">CAR</span>
                                <input *ngIf="editandoAtributos" type="number" class="attr-input" [(ngModel)]="jogador.atributos.carisma" (change)="saveToCache()">
                                <span *ngIf="!editandoAtributos" class="attr-value">{{jogador.atributos.carisma || 10}}</span>
                                <span class="attr-modifier">{{ (calcularModificador(jogador.atributos.carisma) ?? 0) >= 0 ? '+' : '' }}{{ calcularModificador(jogador.atributos.carisma) ?? 0 }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Collapsible Sections -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-body">
                    <div class="section-buttons">
                        <button class="btn btn-outline-primary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseMagias">
                            <i class="fas fa-magic me-2"></i>Magias
                        </button>
                        <button class="btn btn-outline-success" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTalentos">
                            <i class="fas fa-star me-2"></i>Talentos
                        </button>
                        <button class="btn btn-outline-warning" type="button" data-bs-toggle="collapse" data-bs-target="#collapseMochila">
                            <i class="fas fa-backpack me-2"></i>Mochila
                        </button>
                        <button class="btn btn-outline-info" type="button" data-bs-toggle="collapse" data-bs-target="#collapseEquipamentos">
                            <i class="fas fa-shield-alt me-2"></i>Equipamentos
                        </button>
                        <button class="btn btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#collapsePericias">
                            <i class="fas fa-tasks me-2"></i>Perícias
                        </button>
                        <button class="btn btn-outline-danger" type="button" data-bs-toggle="collapse" data-bs-target="#collapseCondicoes">
                            <i class="fas fa-heart-broken me-2"></i>Condições
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Magias -->
    <div class="collapse" id="collapseMagias">
        <div class="card shadow-sm mb-3">
            <div class="card-header bg-primary text-white">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="fas fa-magic me-2"></i>Magias</h5>
                    <button type="button" class="btn btn-light btn-sm" (click)="adicionarMagia()">
                        <i class="fas fa-plus me-1"></i>Adicionar
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div class="spell-list" *ngIf="jogador.magias && jogador.magias.length > 0">
                    <div class="spell-item" *ngFor="let magia of jogador.magias; let i = index">
                        <div *ngIf="!editandoMagia[i]">
                            <div class="spell-header">
                                <div>
                                    <i class="fas fa-wand-magic text-primary"></i>
                                    <strong>{{magia.nome}}</strong>
                                </div>
                                <div>
                                    <button type="button" class="btn btn-sm btn-outline-primary me-1" (click)="toggleEditarMagia(i)">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button type="button" class="btn btn-sm btn-danger" (click)="removerMagia(i)">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </div>
                            </div>
                            <p class="spell-description">{{magia.descricao}}</p>
                        </div>
                        <div *ngIf="editandoMagia[i]" class="edit-form">
                            <div class="row g-2">
                                <div class="col-md-4">
                                    <input type="text" class="form-control" [(ngModel)]="magia.nome" (change)="saveToCache()">
                                </div>
                                <div class="col-md-6">
                                    <input type="text" class="form-control" [(ngModel)]="magia.descricao" (change)="saveToCache()">
                                </div>
                                <div class="col-md-2">
                                    <button type="button" class="btn btn-success btn-sm w-100" (click)="toggleEditarMagia(i)">
                                        <i class="fas fa-check"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div *ngIf="!jogador.magias || jogador.magias.length === 0" class="text-muted text-center py-3">
                    <i class="fas fa-magic fa-2x mb-2"></i>
                    <p>Nenhuma magia adicionada ainda</p>
                </div>
                <div *ngIf="adicionandoMagia" class="add-form mt-3">
                    <div class="row g-2">
                        <div class="col-md-4">
                            <input type="text" class="form-control" placeholder="Nome da Magia" [(ngModel)]="novaMagia.nome">
                        </div>
                        <div class="col-md-6">
                            <input type="text" class="form-control" placeholder="Descrição da Magia" [(ngModel)]="novaMagia.descricao">
                        </div>
                        <div class="col-md-2">
                            <button type="button" class="btn btn-success btn-sm w-100" (click)="confirmarAdicionarMagia()">
                                <i class="fas fa-check"></i>
                            </button>
                            <button type="button" class="btn btn-danger btn-sm w-100 mt-1" (click)="cancelarAdicionarMagia()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Talentos -->
    <div class="collapse" id="collapseTalentos">
        <div class="card shadow-sm mb-3">
            <div class="card-header bg-success text-white">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="fas fa-star me-2"></i>Talentos</h5>
                    <button type="button" class="btn btn-light btn-sm" (click)="adicionarTalento()">
                        <i class="fas fa-plus me-1"></i>Adicionar
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div class="talent-list" *ngIf="jogador.talentos && jogador.talentos.length > 0">
                    <div class="talent-item" *ngFor="let talento of jogador.talentos; let i = index">
                        <div *ngIf="!editandoTalento[i]">
                            <div class="talent-header">
                                <div>
                                    <i class="fas fa-certificate text-success"></i>
                                    <strong>{{talento.nome}}</strong>
                                </div>
                                <div>
                                    <button type="button" class="btn btn-outline-success btn-sm me-1" (click)="toggleEditarTalento(i)">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button type="button" class="btn btn-danger btn-sm" (click)="removerTalento(talento)">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </div>
                            </div>
                            <p class="talent-description">{{talento.descricao}}</p>
                        </div>
                        <div *ngIf="editandoTalento[i]" class="edit-form">
                            <div class="row g-2">
                                <div class="col-md-4">
                                    <input type="text" class="form-control" [(ngModel)]="talento.nome" (change)="saveToCache()">
                                </div>
                                <div class="col-md-6">
                                    <input type="text" class="form-control" [(ngModel)]="talento.descricao" (change)="saveToCache()">
                                </div>
                                <div class="col-md-2">
                                    <button type="button" class="btn btn-success btn-sm w-100" (click)="toggleEditarTalento(i)">
                                        <i class="fas fa-check"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div *ngIf="!jogador.talentos || jogador.talentos.length === 0" class="text-muted text-center py-3">
                    <i class="fas fa-star fa-2x mb-2"></i>
                    <p>Nenhum talento adicionado ainda</p>
                </div>
                <div *ngIf="adicionandoTalento" class="add-form mt-3">
                    <div class="row g-2">
                        <div class="col-md-4">
                            <input type="text" class="form-control" placeholder="Nome do Talento" [(ngModel)]="novoTalento.nome">
                        </div>
                        <div class="col-md-6">
                            <input type="text" class="form-control" placeholder="Descrição do Talento" [(ngModel)]="novoTalento.descricao">
                        </div>
                        <div class="col-md-2">
                            <button type="button" class="btn btn-success btn-sm w-100" (click)="confirmarAdicionarTalento()">
                                <i class="fas fa-check"></i>
                            </button>
                            <button type="button" class="btn btn-danger btn-sm w-100 mt-1" (click)="cancelarAdicionarTalento()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mochila -->
    <div class="collapse" id="collapseMochila">
        <div class="card shadow-sm mb-3">
            <div class="card-header bg-warning text-dark">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="fas fa-backpack me-2"></i>Mochila</h5>
                    <button type="button" class="btn btn-dark btn-sm" (click)="adicionarItem()">
                        <i class="fas fa-plus me-1"></i>Adicionar
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div class="item-list" *ngIf="jogador.mochila && jogador.mochila.length > 0">
                    <div class="item-card" *ngFor="let item of jogador.mochila; let i = index">
                        <div *ngIf="!editandoItem[i]">
                            <div class="item-header">
                                <div>
                                    <i class="fas fa-box text-warning"></i>
                                    <strong>{{item.nome}}</strong>
                                </div>
                                <div>
                                    <button type="button" class="btn btn-outline-warning btn-sm me-1" (click)="toggleEditarItem(i)">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button type="button" class="btn btn-danger btn-sm" (click)="removerItem(item)">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </div>
                            </div>
                            <p class="item-description">{{item.descricao}}</p>
                        </div>
                        <div *ngIf="editandoItem[i]" class="edit-form">
                            <div class="row g-2">
                                <div class="col-md-4">
                                    <input type="text" class="form-control" [(ngModel)]="item.nome" (change)="saveToCache()">
                                </div>
                                <div class="col-md-6">
                                    <input type="text" class="form-control" [(ngModel)]="item.descricao" (change)="saveToCache()">
                                </div>
                                <div class="col-md-2">
                                    <button type="button" class="btn btn-success btn-sm w-100" (click)="toggleEditarItem(i)">
                                        <i class="fas fa-check"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div *ngIf="!jogador.mochila || jogador.mochila.length === 0" class="text-muted text-center py-3">
                    <i class="fas fa-backpack fa-2x mb-2"></i>
                    <p>Nenhum item na mochila</p>
                </div>
                <div *ngIf="adicionandoItem" class="add-form mt-3">
                    <div class="row g-2">
                        <div class="col-md-4">
                            <input type="text" class="form-control" placeholder="Nome do Item" [(ngModel)]="novoItem.nome">
                        </div>
                        <div class="col-md-6">
                            <input type="text" class="form-control" placeholder="Descrição do Item" [(ngModel)]="novoItem.descricao">
                        </div>
                        <div class="col-md-2">
                            <button type="button" class="btn btn-success btn-sm w-100" (click)="confirmarAdicionarItem()">
                                <i class="fas fa-check"></i>
                            </button>
                            <button type="button" class="btn btn-danger btn-sm w-100 mt-1" (click)="cancelarAdicionarItem()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Equipamentos -->
    <div class="collapse" id="collapseEquipamentos">
        <div class="card shadow-sm mb-3">
            <div class="card-header bg-info text-white">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="fas fa-shield-alt me-2"></i>Equipamentos</h5>
                    <div>
                        <button type="button" class="btn btn-light btn-sm me-2" (click)="adicionarEquipamento()">
                            <i class="fas fa-plus me-1"></i>Adicionar
                        </button>
                        <span class="gold-display">
                            <i class="fas fa-coins me-1"></i>
                            <input type="number" class="gold-input" [(ngModel)]="jogador.ouro" (change)="saveToCache()"> PO
                        </span>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="equipment-grid" *ngIf="hasEquipment()">
                    <div *ngFor="let categoria of ['cabeca', 'armadura', 'pes','escudo', 'anel','amuleto']" class="equipment-category">
                        <h6 class="category-title" *ngIf="jogador.equipamentos[categoria]?.length > 0">
                            <i class="fas" [ngClass]="getCategoryIcon(categoria)"></i>
                            {{ getCategoryName(categoria) }}
                        </h6>
                        <div class="equipment-item" *ngFor="let equipamento of jogador.equipamentos[categoria]; let i = index">
                            <div *ngIf="!editandoEquipamento[categoria]?.[i]">
                                <div class="equipment-header">
                                    <strong>{{equipamento.nome}}</strong>
                                    <div>
                                        <button type="button" class="btn btn-outline-info btn-sm me-1" (click)="toggleEditarEquipamento(categoria, i)">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button type="button" class="btn btn-danger btn-sm" (click)="removerEquipamento(categoria, equipamento)">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                    </div>
                                </div>
                                <p class="equipment-description">{{equipamento.descricao}}</p>
                            </div>
                            <div *ngIf="editandoEquipamento[categoria]?.[i]" class="edit-form">
                                <div class="row g-2">
                                    <div class="col-md-5">
                                        <input type="text" class="form-control" [(ngModel)]="equipamento.nome" (change)="saveToCache()">
                                    </div>
                                    <div class="col-md-5">
                                        <input type="text" class="form-control" [(ngModel)]="equipamento.descricao" (change)="saveToCache()">
                                    </div>
                                    <div class="col-md-2">
                                        <button type="button" class="btn btn-success btn-sm w-100" (click)="toggleEditarEquipamento(categoria, i)">
                                            <i class="fas fa-check"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div *ngIf="!hasEquipment()" class="text-muted text-center py-3">
                    <i class="fas fa-shield-alt fa-2x mb-2"></i>
                    <p>Nenhum equipamento adicionado</p>
                </div>
                <div *ngIf="adicionandoEquipamento" class="add-form mt-3">
                    <div class="row g-2">
                        <div class="col-md-3">
                            <select class="form-select" [(ngModel)]="novaCategoria">
                                <option value="" disabled selected>Categoria</option>
                                <option value="cabeca">Cabeça</option>
                                <option value="armadura">Armadura</option>
                                <option value="pes">Pés</option>
                                <option value="escudo">Escudo</option>
                                <option value="amuleto">Amuleto</option>
                                <option value="anel">Anel</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <input type="text" class="form-control" placeholder="Nome" [(ngModel)]="novoEquipamento.nome">
                        </div>
                        <div class="col-md-4">
                            <input type="text" class="form-control" placeholder="Descrição" [(ngModel)]="novoEquipamento.descricao">
                        </div>
                        <div class="col-md-2">
                            <button type="button" class="btn btn-success btn-sm w-100" (click)="confirmarAdicionarEquipamento()">
                                <i class="fas fa-check"></i>
                            </button>
                            <button type="button" class="btn btn-danger btn-sm w-100 mt-1" (click)="cancelarAdicionarEquipamento()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Perícias -->
    <div class="collapse" id="collapsePericias">
        <div class="card shadow-sm mb-3">
            <div class="card-header bg-secondary text-white">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="fas fa-tasks me-2"></i>Perícias</h5>
                    <button type="button" class="btn btn-light btn-sm" (click)="toggleEditarPericias()">
                        <i class="fas" [ngClass]="editandoPericias ? 'fa-check' : 'fa-edit'" [title]="editandoPericias ? 'Salvar' : 'Editar'"></i>
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div *ngIf="!editandoPericias">
                    <div class="skills-grid">
                        <div class="skill-badge" *ngFor="let pericia of jogador.pericias">
                            <span *ngIf="pericia.valor === 'sim'" class="badge bg-success">
                                <i class="fas fa-check-circle me-1"></i>{{pericia.nome}}
                            </span>
                        </div>
                    </div>
                    <div *ngIf="!hasProficiencies()" class="text-muted text-center py-3">
                        <i class="fas fa-tasks fa-2x mb-2"></i>
                        <p>Nenhuma perícia selecionada</p>
                    </div>
                </div>
                <div *ngIf="editandoPericias" class="skills-checklist">
                    <div class="row g-2">
                        <div class="col-md-6" *ngFor="let pericia of jogador.pericias">
                            <div class="form-check skill-check">
                                <input class="form-check-input" type="checkbox"
                                    (change)="updatePericiaValor($event, pericia); saveToCache()"
                                    [id]="'pericia_' + pericia.nome" name="pericia_{{pericia.nome}}">
                                <label class="form-check-label" [for]="'pericia_' + pericia.nome">
                                    <i class="fas fa-check-circle me-1"></i>{{ pericia.nome }}
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Condições -->
    <div class="collapse" id="collapseCondicoes">
        <div class="card shadow-sm mb-3">
            <div class="card-header bg-danger text-white">
                <h5 class="mb-0"><i class="fas fa-heart-broken me-2"></i>Condições</h5>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-4 col-sm-6">
                        <div class="condition-box">
                            <i class="fas fa-utensils text-warning"></i>
                            <label>Fome</label>
                            <input type="number" class="form-control" [(ngModel)]="jogador.fome" (change)="saveToCache()">
                        </div>
                    </div>
                    <div class="col-md-4 col-sm-6">
                        <div class="condition-box">
                            <i class="fas fa-tint text-info"></i>
                            <label>Sede</label>
                            <input type="number" class="form-control" [(ngModel)]="jogador.sede" (change)="saveToCache()">
                        </div>
                    </div>
                    <div class="col-md-4 col-sm-6">
                        <div class="condition-box">
                            <i class="fas fa-tired text-secondary"></i>
                            <label>Cansaço</label>
                            <input type="number" class="form-control" [(ngModel)]="jogador.cansaco" (change)="saveToCache()">
                        </div>
                    </div>
                    <div class="col-md-4 col-sm-6">
                        <div class="condition-box">
                            <i class="fas fa-sun text-danger"></i>
                            <label>Calor</label>
                            <input type="number" class="form-control" [(ngModel)]="jogador.calor" (change)="saveToCache()">
                        </div>
                    </div>
                    <div class="col-md-4 col-sm-6">
                        <div class="condition-box">
                            <i class="fas fa-snowflake text-primary"></i>
                            <label>Frio</label>
                            <input type="number" class="form-control" [(ngModel)]="jogador.frio" (change)="saveToCache()">
                        </div>
                    </div>
                    <div class="col-md-4 col-sm-6">
                        <div class="condition-box">
                            <i class="fas fa-bed text-dark"></i>
                            <label>Sono</label>
                            <input type="number" class="form-control" [(ngModel)]="jogador.sono" (change)="saveToCache()">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Dialog -->
    <div *ngIf="confirmandoLimparCache" class="confirmation-overlay">
        <div class="confirmation-dialog card shadow-lg">
            <div class="card-body text-center">
                <i class="fas fa-exclamation-triangle fa-3x text-warning mb-3"></i>
                <h5><strong>Tem certeza que deseja apagar todos os dados do jogador?</strong></h5>
                <p class="text-muted">Esta ação não pode ser desfeita!</p>
                <div class="mt-3">
                    <button class="btn btn-success me-2" (click)="limparCache()">
                        <i class="fas fa-check me-1"></i>Sim, apagar
                    </button>
                    <button class="btn btn-secondary" (click)="cancelarLimparCache()">
                        <i class="fas fa-times me-1"></i>Cancelar
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="editarFichaModal" tabindex="-1" aria-labelledby="editarFichaModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content rpg-modal">
            <div class="modal-header bg-gradient-primary">
                <h5 class="modal-title" id="editarFichaModalLabel">
                    <i class="fas fa-scroll me-2"></i>Editar Ficha do Jogador
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form>
                    <!-- Basic Info Section -->
                    <div class="form-section">
                        <h6 class="section-heading">
                            <i class="fas fa-user me-2"></i>Informações Básicas
                        </h6>
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label for="nome" class="form-label">
                                    <i class="fas fa-signature me-1"></i>Nome
                                </label>
                                <input type="text" class="form-control" id="nome" [(ngModel)]="jogador.nome" name="nome" placeholder="Nome do personagem">
                            </div>
                            <div class="col-md-4">
                                <label for="classe" class="form-label">
                                    <i class="fas fa-hat-wizard me-1"></i>Classe
                                </label>
                                <input type="text" class="form-control" id="classe" [(ngModel)]="jogador.classe"
                                    name="classe" placeholder="Ex: Guerreiro">
                            </div>
                            <div class="col-md-4">
                                <label for="raca" class="form-label">
                                    <i class="fas fa-users me-1"></i>Raça
                                </label>
                                <input type="text" class="form-control" id="raca" [(ngModel)]="jogador.raca" name="raca" placeholder="Ex: Humano">
                            </div>
                            <div class="col-md-6">
                                <label for="proficiencia" class="form-label">
                                    <i class="fas fa-certificate me-1"></i>Bônus de Proficiência
                                </label>
                                <input type="number" class="form-control" id="proficiencia" [(ngModel)]="jogador.proficiencia"
                                    name="proficiencia" placeholder="Ex: 2">
                            </div>
                            <div class="col-md-6">
                                <label for="nivel" class="form-label">
                                    <i class="fas fa-level-up-alt me-1"></i>Nível
                                </label>
                                <input type="number" class="form-control" id="nivel" [(ngModel)]="jogador.nivel"
                                    name="nivel" placeholder="Ex: 1">
                            </div>
                        </div>
                    </div>

                    <!-- Combat Stats Section -->
                    <div class="form-section">
                        <h6 class="section-heading">
                            <i class="fas fa-shield-alt me-2"></i>Estatísticas de Combate
                        </h6>
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label for="pv" class="form-label">
                                    <i class="fas fa-heart me-1"></i>Pontos de Vida (PV)
                                </label>
                                <input type="number" class="form-control" id="pv" [(ngModel)]="jogador.pv" name="pv" placeholder="Ex: 10">
                            </div>
                            <div class="col-md-4">
                                <label for="pva" class="form-label">
                                    <i class="fas fa-heartbeat me-1"></i>PV Atual
                                </label>
                                <input type="number" class="form-control" id="pva" [(ngModel)]="jogador.pva" name="pva" placeholder="Ex: 10">
                            </div>
                            <div class="col-md-4">
                                <label for="ca" class="form-label">
                                    <i class="fas fa-shield me-1"></i>Classe de Armadura (CA)
                                </label>
                                <input type="number" class="form-control" id="ca" [(ngModel)]="jogador.ca" name="ca" placeholder="Ex: 15">
                            </div>
                            <div class="col-md-4">
                                <label for="deslocamento" class="form-label">
                                    <i class="fas fa-running me-1"></i>Deslocamento
                                </label>
                                <input type="number" class="form-control" id="deslocamento"
                                    [(ngModel)]="jogador.deslocamento" name="deslocamento" placeholder="Ex: 30">
                            </div>
                            <div class="col-md-4">
                                <label for="iniciativa" class="form-label">
                                    <i class="fas fa-bolt me-1"></i>Iniciativa
                                </label>
                                <input type="number" class="form-control" id="iniciativa" [(ngModel)]="jogador.iniciativa"
                                    name="iniciativa" placeholder="Ex: 2">
                            </div>
                            <div class="col-md-4">
                                <label for="inspiracao" class="form-label">
                                    <i class="fas fa-star me-1"></i>Inspiração
                                </label>
                                <input type="number" class="form-control" id="inspiracao" [(ngModel)]="jogador.inspiracao"
                                    name="inspiracao" placeholder="Ex: 0">
                            </div>
                        </div>
                    </div>

                    <!-- Attributes Section -->
                    <div class="form-section">
                        <h6 class="section-heading">
                            <i class="fas fa-dumbbell me-2"></i>Atributos
                        </h6>
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label for="forca" class="form-label">
                                    <i class="fas fa-fist-raised me-1"></i>Força
                                </label>
                                <input type="number" class="form-control" id="forca" [(ngModel)]="jogador.atributos.forca"
                                    name="forca" placeholder="Ex: 10">
                            </div>
                            <div class="col-md-4">
                                <label for="destreza" class="form-label">
                                    <i class="fas fa-running me-1"></i>Destreza
                                </label>
                                <input type="number" class="form-control" id="destreza"
                                    [(ngModel)]="jogador.atributos.destreza" name="destreza" placeholder="Ex: 10">
                            </div>
                            <div class="col-md-4">
                                <label for="constituicao" class="form-label">
                                    <i class="fas fa-heart me-1"></i>Constituição
                                </label>
                                <input type="number" class="form-control" id="constituicao"
                                    [(ngModel)]="jogador.atributos.constituicao" name="constituicao" placeholder="Ex: 10">
                            </div>
                            <div class="col-md-4">
                                <label for="inteligencia" class="form-label">
                                    <i class="fas fa-brain me-1"></i>Inteligência
                                </label>
                                <input type="number" class="form-control" id="inteligencia"
                                    [(ngModel)]="jogador.atributos.inteligencia" name="inteligencia" placeholder="Ex: 10">
                            </div>
                            <div class="col-md-4">
                                <label for="sabedoria" class="form-label">
                                    <i class="fas fa-eye me-1"></i>Sabedoria
                                </label>
                                <input type="number" class="form-control" id="sabedoria"
                                    [(ngModel)]="jogador.atributos.sabedoria" name="sabedoria" placeholder="Ex: 10">
                            </div>
                            <div class="col-md-4">
                                <label for="carisma" class="form-label">
                                    <i class="fas fa-comments me-1"></i>Carisma
                                </label>
                                <input type="number" class="form-control" id="carisma"
                                    [(ngModel)]="jogador.atributos.carisma" name="carisma" placeholder="Ex: 10">
                            </div>
                        </div>
                    </div>

                    <!-- Skills Section -->
                    <div class="form-section">
                        <h6 class="section-heading">
                            <i class="fas fa-tasks me-2"></i>Perícias
                        </h6>
                        <div class="skills-checklist">
                            <div class="row g-2">
                                <div class="col-md-6" *ngFor="let pericia of jogador.pericias">
                                    <div class="form-check skill-check">
                                        <input class="form-check-input" type="checkbox" [(ngModel)]="pericia.valor"
                                            (change)="updatePericiaValor($event, pericia)" [checked]="pericia.valor === 'sim'"
                                            [id]="'pericia_' + pericia.nome" name="pericia_{{pericia.nome}}">
                                        <label class="form-check-label" [for]="'pericia_' + pericia.nome">
                                            <i class="fas fa-check-circle me-1"></i>{{ pericia.nome }}
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>Cancelar
                </button>
                <button type="button" class="btn btn-primary" (click)="saveToCache()" data-bs-dismiss="modal">
                    <i class="fas fa-save me-2"></i>Salvar Alterações
                </button>
            </div>
        </div>
    </div>
</div>